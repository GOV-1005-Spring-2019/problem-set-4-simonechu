---
title: "Problem Set 4"
author: "Simone Chu"
date: "2/25/2019"
output: html_document
---

```{r setup, include=FALSE}
# knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(janitor)
library(knitr)
library(gt)
library(lubridate)
library(base)
```

```{r madlibs, include=FALSE, message=FALSE, echo=FALSE}
nc_09 <- read_csv("ps_4_elections-poll-nc09-3.csv") %>%
  filter(!is.na(file_race),
         !is.na(response),
         !is.na(ager == "[DO NOT READ] Refused"),
         !is.na(final_weight),
         educ != "[DO NOT READ] Refused") 

n_dem_support <- nc_09 %>%
  filter(response == "Dem") %>%
  count()
  
only_reps <- nc_09 %>%
    filter(response == "Rep") %>%
    count()

only_und <- nc_09 %>%
  filter(response == "Und") %>%
  count()

rep_vs_und <- (only_reps) - (only_und) 

gender_compare <- nc_09 %>%
  select(gender, gender_combined) %>%
  filter(gender != gender_combined) %>%
  count()
  
race_eth_v_file_race <- nc_09 %>%
  filter(race_eth == "White") %>%
  filter(file_race_black != "White") %>%
  count()

firstDem <- nc_09 %>%
  filter(response == "Dem") %>%
  arrange(timestamp) %>%
  slice(1) %>%
  select(timestamp)

firstRep <- nc_09 %>%
  filter(response == "Rep") %>%
  arrange(timestamp) %>%
  slice(1) %>%
  select(timestamp)

timediff <- round(as.numeric(firstRep - firstDem))

```
### Question 1

There were `r n_dem_support` respondents who supported the Democratic candidate. 

There were `r rep_vs_und` more respondents who favored the Republican candidate than who were Undecided.

There are two gender variables (`gender` and `gender_combined`). There are `r gender_compare` individuals for whom these variables have different values.

There are `r race_eth_v_file_race` respondents listed as “White” under `race_eth` who are not listed as “White” under `file_race_black`.

The first response of Rep came `r timediff` minutes (rounded to the nearest minute) before the first response of Dem.

### Question 2
```{r chart, echo=FALSE, message=FALSE}
for_chart <- read_csv(
  file = "ps_4_elections-poll-nc09-3.csv",
                 col_types = cols(
                   .default = col_character(),
                   turnout_scale = col_double(),
                   turnout_score = col_double(),
                   w_LV = col_double(),
                   w_RV = col_double(),
                   final_weight = col_double(),
                   timestamp = col_datetime(format = ""))) %>%
  filter(!is.na(file_race),
         !is.na(response),
         !is.na(ager == "[DO NOT READ] Refused"),
         !is.na(final_weight),
         educ != "[DO NOT READ] Refused") 

for_chart %>% 
  select(response, race_eth, final_weight) %>% 
  group_by(race_eth, response) %>% 
  summarize(total = sum(final_weight)) %>%   
  filter(!is.na(race_eth)) %>%
  filter(response != "3") %>%
  filter(race_eth != "[DO NOT READ] Don't know/Refused") %>%
  spread(key =  response, value = total) %>% 
  mutate(all = Dem + Rep + Und) %>% 
  mutate(Dem = Dem / all) %>% 
  mutate(Rep = Rep / all) %>% 
  mutate(Und = Und / all) %>% 
  select(-all) %>% 
  ungroup() %>% 
  gt() %>% 
    tab_header(
      title = "Polling Results in North Carolina 9th Congressional District") %>% 
    
    cols_label(
      race_eth = "Race",
      Dem = "DEM.",
      Rep = "REP.",
      Und = "UND."
      ) %>%
  
    # tab_style(
    #   style = cells_styles(
    #     bkgd_color = "red"), 
    #   location = cells_data(
    #     columns = Rep,
    #     rows = "White", "Hispanic", "Asian"
    #   ))   %>%
  
    fmt_percent(columns = vars(Dem, Rep, Und),
                decimals = 0)


```

### Question 3
```{r, echo=FALSE, message=FALSE}
nc_09 %>%
  filter(educ %in% c("Graduate or Professional Degree", "Bachelors' Degree", "Some college or trade school", "High school", "Grade school")) %>%
  ggplot(mapping = aes(x = final_weight, y = educ)) + 
  geom_violin(scale = "area") + 
   labs(title = "More Educated Matter Less in North Carolina 9th",
       subtitle = "Poll gives more weight to people who are less likely to participate in polls",
       caption = "New York Times Upshot/Siena College 2018 live polls") + 
  xlab("Weight Given to Respondent in Calculating Poll Results") + 
  ylab(NULL)

```

### Question 4


### Collaborators

Margaret Sun, Igor Morzan